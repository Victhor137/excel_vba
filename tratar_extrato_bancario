Sub Planilha_Extrato_TratarExtrato()

    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Digite o nome da sua aba") ' Altere conforme necessário

    Dim i As Integer
    Dim descricao As String
    Dim rng As Range
    Dim cel As Range
    Dim textoOriginal As String
    Dim textoLimpo As String
    Dim regex As Object
    Set regex = CreateObject("VBScript.RegExp")
    
    ' Regex para capturar número brasileiro com vírgula decimal, com sinal opcional
    With regex
        .Global = False
        .IgnoreCase = True
        .Pattern = "-?\d{1,3}(?:\.\d{3})*,\d{2}|-?\d+,\d{2}"
    End With

    ' Loop pelas colunas A2 até J2
    For i = 1 To 10
        descricao = Trim(UCase(ws.Cells(2, i).Value))
        
        Select Case descricao
        
            ' HISTÓRICO ? Texto
            Case "HISTÓRICO"
                Set rng = ws.Range(ws.Cells(3, i), ws.Cells(1000, i))
                rng.NumberFormat = "@" ' Formato texto

            ' DATA ? Converte número para data
            Case "DATA"
                Set rng = ws.Range(ws.Cells(3, i), ws.Cells(1000, i))
                For Each cel In rng
                    If IsNumeric(cel.Value) And cel.Value <> "" Then
                        cel.Value = DateValue(cel.Value)
                    End If
                Next cel
                rng.NumberFormat = "dd/mm/yyyy"

            ' VLR_D, VLR_C ? Apenas aplicar formatação numérica
            Case "VLR_D", "VLR_C"
                Set rng = ws.Range(ws.Cells(3, i), ws.Cells(1000, i))
                rng.NumberFormat = "0.00"
            
            ' VLR_D+C ? Tratar e converter valores
            Case "VLR_D+C"
                Set rng = ws.Range(ws.Cells(3, i), ws.Cells(1000, i))
                
                For Each cel In rng
                    textoOriginal = Trim(cel.Value)
                    If textoOriginal <> "" Then
                        
                        ' Extrai o número com sinal, se houver
                        If regex.Test(textoOriginal) Then
                            textoLimpo = regex.Execute(textoOriginal)(0).Value
                            
                            ' Converte formato brasileiro para número reconhecível
                            textoLimpo = Replace(Replace(textoLimpo, ".", ""), ",", ".")
                            
                            If IsNumeric(textoLimpo) Then
                                cel.Value = CDbl(textoLimpo)
                            Else
                                cel.ClearContents
                            End If
                        Else
                            cel.ClearContents
                        End If
                    End If
                Next cel
                
                rng.NumberFormat = "0.00"
        
        End Select
    Next i

    MsgBox "Formatação completa concluída!", vbInformation

End Sub
